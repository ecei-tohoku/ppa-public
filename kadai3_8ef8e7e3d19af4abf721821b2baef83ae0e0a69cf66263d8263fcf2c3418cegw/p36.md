---
layout: page
title: 3-6. ナンプレ解探索
---

ナンバープレイス（商標として「数独」と呼ばれるものと同じ）を解くプログラムを作成してみよう．
これは，再帰関数を改めて学ぶための題材である．

ナンバープレイスのルールは，81マスの盤面に対して，1から9までの数字が
- 行または列に対して，2つ以上同じ数字があってはいけない
- 3x3の部分的なマスに対しても同じ値が二つ以上出現してはいけない
というものである．

つまり，ランダムに数字を入れていって，条件を満たしているかを判定し，上記条件が満たされていれば，完成していることがわかる．

しかし，何も工夫しなければ，$9^{81}$通りの盤面が存在するが，実際にはそれほど多くの盤面を調べる必要はない．
- 最初からいくつかの数は提示されている．
- 数字を一つずつ入れていき，上記条件を満たさない場合はそれ以上評価する必要がない．

これらの性質をうまく利用して，効率的なナンプレの自動解法のプログラムを考える．

---
## 問題
---

ナンバープレイスの問題を与えると，自動で答えを出力するプログラムを作成せよ．

---
### 仕様
---
- 必ず再帰関数を使ってプログラムを構築すること．

- グローバル変数や静的変数を使用してはいけない．
- `include`するファイルは`<stdio.h>`および`<stdlib.h>`のみとする．

- 盤面を保持する記憶領域として，一次元の81個分のintを`func_mallocation_`関数を持ちいて確保し，それを利用すること．
  - 二次元の盤面への展開は配列の場所を計算することで実現する．

- 盤面の表示には，`print_matrix_`を使う．

- 入力は空白または改行文字で区切られた合計81の0-9の値である．
  - 値は必ず0から9の値であることを仮定して良い．
  - 1-9の値は，事前に決められた値とする．
  - 0は値が決まっていないことを表す．
  - 入力デーたは，便宜上左上を開始として，9この数字で一行を表すとする．

- 入力データを読み込んだ直後に値を表示する．
  - 9x9の形に整形すること，値が埋まっていない場所は0を表示する．
  - 盤面を表示する前に以下の表示をする．
    ```
    ##⊔INIT↩︎
    ````
- 答えが見つかったらそれを表示する．
  - 答えが複数ある場合もある．その場合は複数の答えを列挙する．
  - 盤面を表示する前に以下の表示をする．複数答えがある場合は盤面を表示する前に毎回表示する．
    ```
    ##⊔FOUND↩︎
    ````
  - もし答えが見つからなかったら以下の表示をして盤面は表示しない．
    ```
    ##⊔NOT⊔FOUND↩︎
    ````

  - 再帰関数を呼んだ回数を<font color="red">標準エラー出力</font>に表示する．




- 以下のプログラムを必ず用いてプログラムを完成せること．

```
#include <stdio.h>
#include <stdlib.h>

void print_matrix_(    // ???
    int *const array,  // ???
    const int N        // ???
) {
  int ri;
  int rj;
  for (ri = 0; ri < N; ++ri) {            // ???
    for (rj = 0; rj < N; ++rj) {          // ???
      printf(" %d", array[ri * N + rj]);  // ???
    }
    printf("\n");  // ???
  }
}

int *func_mallocation_(  // ???
    const int N          // ???
) {
  int *data = (int *)malloc(N * sizeof(int));  // ???
  if (data == NULL) {                          // ???
    printf("Can not allocate memory. 'data' is NULL.\n");
    exit(EXIT_FAILURE);  // ???
  }
  return data;  // ???
}
///////


  ... 関数前方宣言 ...

int main() {

  ...(省略)...

  return 0;               //
}

  ...(省略)...
```



---
## 実行例
---

---
### 実行例(1)
---


- 入力例：
```
0 0 5 3 0 0 0 0 0 8 0 0 0 0 0 0 2 0 0 7 0 0 1 0 5 0 0 4 0 0 0 0 5 3 0 0 0 1 0 0 7 0 0 0 6 0 0 3 2 0 0 0 8 0 0 6 0 5 0 0 0 0 9 0 0 4 0 0 0 0 3 0 0 0 0 0 0 9 7 0 0
```

- 出力例：
```
### INIT
 0 0 5 3 0 0 0 0 0
 8 0 0 0 0 0 0 2 0
 0 7 0 0 1 0 5 0 0
 4 0 0 0 0 5 3 0 0
 0 1 0 0 7 0 0 0 6
 0 0 3 2 0 0 0 8 0
 0 6 0 5 0 0 0 0 9
 0 0 4 0 0 0 0 3 0
 0 0 0 0 0 9 7 0 0
### FOUND
 1 4 5 3 2 7 6 9 8
 8 3 9 6 5 4 1 2 7
 6 7 2 9 1 8 5 4 3
 4 9 6 1 8 5 3 7 2
 2 1 8 4 7 3 9 5 6
 7 5 3 2 9 6 4 8 1
 3 6 7 5 4 2 8 1 9
 9 8 4 7 6 1 2 3 5
 5 2 1 8 3 9 7 6 4
```

- 標準エラー出力例：
```
76703
```

---
### 実行例(2)
---

- 入力例：
```
0 0 5 3 0 0 0 0 0 8 0 0 0 0 0 0 2 0 0 7 0 0 1 0 5 0 0 4 0 0 0 0 5 3 0 0 0 1 0 0 7 0 0 0 6 0 0 3 2 0 0 0 8 0 0 6 0 5 0 0 0 0 9 0 0 4 0 0 0 0 3 0 0 0 0 0 0 9 7 0 1
```

- 出力例：
```
### INIT
 0 0 5 3 0 0 0 0 0
 8 0 0 0 0 0 0 2 0
 0 7 0 0 1 0 5 0 0
 4 0 0 0 0 5 3 0 0
 0 1 0 0 7 0 0 0 6
 0 0 3 2 0 0 0 8 0
 0 6 0 5 0 0 0 0 9
 0 0 4 0 0 0 0 3 0
 0 0 0 0 0 9 7 0 1
### NOT FOUND
```

- 標準エラー出力例：
```
44514
```