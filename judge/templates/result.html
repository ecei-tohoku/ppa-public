{% extends "base.html" %}

{% block title %} - {{ current_user.get_id() }} - {{ task.id }}{% endblock %}

{% block content %}

<h1>
  {% if not result %}
  <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
  {% elif result.status == 'ok' %}
  <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
  {% elif result.status == 'fail' %}
  <span class="glyphicon glyphicon glyphicon-remove" aria-hidden="true"></span>
  {% elif result.status == 'error' %}
  <span class="glyphicon glyphicon glyphicon-alert" aria-hidden="true"></span>
  {% elif result.status == 'queue' %}
  <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
  {% endif %}
  {{ current_user.get_id() }} - {{ task.id }}: {{ task.title }}
</h1>

{% if not result %}
<div class="alert alert-warning" role="alert">ソースコードが未提出です．</div>
{% elif result.status == 'fail' %}
<div class="alert alert-danger" role="alert">テストで不合格となりました ({{ result.passed }} / {{ result.tests | count }})．</div>
{% elif result.status == 'error' %}
<div class="alert alert-warning" role="alert">内部エラーが発生しました．</div>
{% elif result.status == 'queue' %}
<div class="alert alert-info" role="alert">テスト中です (submitted at {{ result.timestamp }})．</div>
{% endif %}

{% if result %}

<h2>ソース</h2>
<pre class="prettyprint lang-c linenums">{{ result.source }}</pre>

{% if result.compile and result.compile.returncode != 0 %}
<h2>コンパイル</h2>
<div class="panel panel-danger">
  <div class="panel-heading">ERROR (return code: {{ result.compile.returncode }})</div>
  <div class="panel-body"><pre>$ {{ result.compile.cmd }}
{{ result.compile.message }}</pre></div>
</div>
{% endif %}

{% if result.compile and result.compile.returncode == 0 %}
<h2>テスト</h2>
{% for test in result.tests %}
{% if test.status == 'ok' %}
<div class="panel panel-success">
{% else %}
<div class="panel panel-danger">
{% endif %}

  <div class="panel-heading">
    Case {{ test.cid }}:
    {% if test.status == 'ok' %}
    成功 (return code: {{ test.returncode }})
    {% elif test.status == 'fail' %}
    失敗 (return code: {{ test.returncode }})
    {% elif test.status == 'timeout' %}
    タイムアウト
    {% endif %}
  </div>
  <div class="panel-body">
    {% if test.argv %}ARGV<pre>{{ test.argv }}</pre>{% endif %}
    {% if test.stdin %}STDIN<pre class="io">{{ test.stdin }}</pre>{% endif %}
    {% if test.stdout %}STDOUT<pre class="io">{{ test.stdout }}</pre>{% endif %}
    {% if test.stderr %}STDERR<pre class="io">{{ test.stderr }}</pre>{% endif %}
  </div>
</div>
{% endfor %}
{% endif %}

<hr>
{{ result._id }} submitted at {{ result.timestamp }}

{% endif %}

{% endblock %}
