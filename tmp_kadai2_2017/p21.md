---
layout: page
title: 2-1. 関数と動的メモリ確保【10点，2週目のみ採点】
---

C 言語のプログラムは，`main` 関数内に動作させたい内容を記述すればよいが，プログラムの規模が大きくなるにつれて，`main` 関数の内容が膨大になってしまう．このような場合，適当な大きさの関数に分割してプログラムを書くことが多い．たとえば，繰り返し計算する部分を関数として実装することで，別の箇所から何回も呼び出すことができる．ここでは，関数を使ったプログラムを作成しよう．

## 問題

標準入力から実数のデータ列を読み込み，その数の出現個数のヒストグラムを書き出すプログラムを作成せよ．ただし，各実数データは 0 から 20 の範囲にあるとしてよい．プログラムは以下の仕様を満たすこと．

- データ列の 1 行目にデータの個数が記載されているので，1 行目を読み込んだ後に，データ列を格納する配列を `malloc` 関数を使って確保すること．なお，すべての処理が完了した後に，配列を `free` 関数を使って解放すること．
- データ列を引数とするヒストグラム描画のための `histogram` 関数を作成すること．
- データ列のそれぞれの実数値を四捨五入して得られる整数値の個数を数えてヒストグラムを描画すること．
- 数え上げる整数値の範囲は，データ列の最小値から最大値までとする．
- ヒストグラムは，縦軸を階級（数え上げる整数値），横軸を度数（数え上げた整数値の個数）とする．
- 階級を 2 桁の数字として表示するとともに，数字の右に半角スペースを 1 つ挿入すること．
- ヒストグラムの棒は，半角のアスタリスク `*` を 1 個分として表現すること．


## 実行例

入力ファイル ([data.txt](./data.txt)) の例

```
10
2.6 3.4 3.2 2.4 8.8 4.3 9.7 2.2 4.1 5.1
```

リダイレクション `<` を用いて `data.txt` の内容を標準入力から読み込む．

```
$ ./a.out < data.txt
```

出力結果の例

```
 2 **
 3 ***
 4 **
 5 *
 6
 7
 8
 9 *
10 *
```

## ヒストグラム

ヒストグラムは，片方の軸に度数，もう片方の軸に階級（ビン）をとったグラフの一種である．データの頻度を視覚的に調べるときに用いられ，度数分布とも言われる．
下図は，[Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%92%E3%82%B9%E3%83%88%E3%82%B0%E3%83%A9%E3%83%A0) で例として使われているヒストグラムである．これは，アメリカで 1973 年から 1978 年にかけて事故死した人数を月毎に集計したものであり，横軸は各月に事故死した人数を 500 人毎に区切った階級を，縦軸は各階級に属する月の数（＝度数）を表している．

![ヒストグラム](https://upload.wikimedia.org/wikipedia/commons/thumb/1/17/UsaccHistogram.svg/495px-UsaccHistogram.svg.png)

## ヒント

### メモリ領域の動的確保

C言語にはメモリ領域を自由に確保できる`malloc`（memory allocation）（えむあろっく，まろっく）という関数が用意されています．`malloc`は確保した領域の先頭ポインタを返すため，[]演算子を用いることで通常の配列のように扱うことができます．`malloc`の使い方は，教科書および解説資料を参照のこと：

- 高橋：10.4 文字列の操作
- 林：17.3 メモリ管理
- [課題解説資料](./kadai2-intro.pdf)

### 配列を引数にとる関数

C言語では以下のように記述することで配列を引数とする関数を作ることができます．

- 記述例(1): int func ( int array[] ){ ・・・ };
- 記述例(2): int func ( int *array ){ ・・・ }; 

例えば配列要素の総和を計算するプログラムは

```
#include <stdio.h>

int func ( int a[], int n )
{
	int i, ans = 0;
	for ( i=0; i < n; i++ )
	{
		ans += a[i];
	}
	return ans;	
}

int main ()
{
	int sum;
	int a[5] = {1,2,3,4,5};

	sum = func ( a, 5 );
	printf ( "%d\n", sum );
	
	return 0;
}
```

のように記述できます．どちらの記述例でも動作しますが，通常の配列とポインタ型を区別するために、`int a[5];` のように宣言した配列を引数とする場合には(1)を，`int *a = (int*)malloc(SIZE);` のように動的に確保した配列を使用する場合には(2)の記述法を用いることが推奨されます．
