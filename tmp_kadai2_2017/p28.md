---
layout: page
title: 2-8. k近傍法による自動健康診断【自動採点システム:5点,仕様:5点，発展問題】
---

<style type="text/css">
  .center {
    text-align: center;
  }
</style>

## 問題

年齢・身長・体重などの患者の情報を与えたとき，過去の診断結果のデータベースに照らし合わせて，その患者が心臓病にかかっているかを自動判定するプログラムを作成せよ．自動判定のアルゴリズムとしてk近傍法を利用せよ．


## k近傍法による健康診断

k近傍法は，与えられたデータをある決められたカテゴリ（**クラス**）に分類するアルゴリズムの一種である．入力データが与えられたとき，最も近い過去の分類の事例 $k$ 個を探し出し，多数決により入力データのクラスを決定する．

本課題では，入力データを患者（後に示されるように，数値の組合せで表される），クラスを診断結果（`0`: 心臓病でない か `1`: 心臓病である）に対応させ，k近傍法を適用する．図1に，患者を「身長と体重の組合せ」で表現し心臓病診断を行う様子を示す．●と▲はそれぞれ過去の患者に対する診断結果を示しており，★がこれから診断を行う対象の患者を示す（ここでは身長170cm, 体重65kg の患者を想定する）．

{: .center}
![](p28.png)
<br />図1. k近傍法による心臓病診断

まずはじめに，過去の診断結果のうち，診断対象の患者に最も近い $k$ 名の患者を探し出す．ここでは，$k=3$ の場合を考えよう．「近い」とは，どのような距離尺度でもよいが，本課題ではユークリッド距離を用いる．図1では，下記のような近傍 3 患者が見つかっている（点線内を参照せよ）．

- 心臓病と診断された患者: 2名
- 心臓病と診断されなかった患者: 1名

最後に多数決を取り，診断対象の患者の診断を下す．ここでは「心臓病である」と診断することになる．


## 入力データ

下記の形式により標準入力から与えられるものとする．


### 過去の診断データ

初めの二行で，過去の診断データの個数 $N$ と，患者の状態を示す数値データの個数 $A$ が与えられる．

```
200
13
```

続いて，$N$ 個の過去の診断データが与えられる．1行につき心臓病診断の結果1件が与えられ，合計 $N$ 行のデータが与えられる．

診断結果1件は，患者の状態を示す $A$ 個の数値データ（性別，身長，体重など）と，診断結果（`0` = 心臓病と診断されなかった or `1` = 心臓病と診断された）の組合わせからなる．スペース区切りで，次のような書式で与えられる（`⊔`は半角スペースを表す）．

```
63.0⊔1.0⊔1.0⊔145.0⊔233.0⊔1.0⊔2.0⊔150.0⊔0.0⊔2.3⊔3.0⊔0.0⊔6.0⊔0
53.0⊔1.0⊔4.0⊔140.0⊔203.0⊔1.0⊔2.0⊔155.0⊔1.0⊔3.1⊔3.0⊔0.0⊔7.0⊔1
57.0⊔1.0⊔4.0⊔140.0⊔192.0⊔0.0⊔0.0⊔148.0⊔0.0⊔0.4⊔2.0⊔0.0⊔6.0⊔0
... (以下197行続く) ...
```


### 自動診断の対象となる患者データ

過去の診断データに引き続いて，本課題が自動診断の対象とする患者のデータが与えられる．過去の診断データと同様に，$A$ 個の数値データからなる（ただし，ここでは「診断結果」が与えられていないことに注意せよ）．

```
50.0⊔0.0⊔3.0⊔120.0⊔219.0⊔0.0⊔0.0⊔158.0⊔0.0⊔1.6⊔2.0⊔0.0⊔3.0
```


## 要求仕様

以上を入力として受け取り，k近傍法を利用して自動健康診断を行う人工知能を実現せよ．本課題では，下記の6つの仕様を満たすこと(以下の仕様を満たしたプログラムに5点を加点する)．

- (1) 標準入力より過去の診断結果のデータを読み込み，$N$ 次元の `int` 配列，$N \times A$ 次元の `double` 型の配列を動的に確保し，過去の診断結果を保存せよ．プログラムの終了前に，確保した配列を解放せよ．

また，k近傍法のプログラムを書くための部品となる関数を次のように作成せよ．

- (2) $n$ 次元の `double` 型の配列で表される座標 $X,Y$ が与えられたとき，$X$-$Y$ 間のユークリッド距離を返す関数 `eu_dist(X, Y, n)` を作成せよ．
- (3) $n$ 次元の `int` 型の配列 $V$ が与えられたとき，$V$ の中で最も頻度の高い値を返す関数 `vote(V, n)` を作成せよ．ただし，$V$ に含まれる値は `0` か `1` の二種類と仮定してよい．例えば，`V = {0, 1, 1, 1, 0, 1, 1}` のとき，`1` を返せ．
- (4) $n$ 次元の `double` 型の配列で表される数列 $X$ と，`int` 型の配列 $Y$ が与えられたとき，$X$ と $Y$ の中身を $X$ の値に基づいて昇順にソートする関数 `sort_by(X, Y, n)` を作成せよ．例えば，`X = [10.2, 50.3, 40.2]`, `Y = [0, 1, 2]` に対して `X = [10.2, 40.2, 50.3], Y = [0, 2, 1]` と並び替えよ．
    - ヒント: 課題2-2で作成した選択ソートのアルゴリズムに一行加えるだけで実現できる．

最後に，k近傍法により自動診断を行う関数を次のように作成せよ．

- (5) 上記 (2), (3), (4) の関数を用いて，$n$ 次元の `double` 型の配列で表される患者の数値データ $P$ と整数 $k$ が与えられたとき，k近傍法により心臓病か否かの診断結果 (`0`: 心臓病でない or `1`: 心臓病である) を返す関数 `knn_diag(P, k)` を作成せよ．このとき，(1) k近傍法における「距離」はユークリッド距離を用い，(2) クラスの決定に用いた近傍事例 $k$ 個を `距離 (実数値)⊔診断結果のクラス (0 or 1)` の形式で出力せよ．なお，(1) で読み込んだ過去の診断結果をグローバル変数として保持し，ここで利用してよい．

診断結果の出力については，下記の仕様を満たせ．

- (6) 標準入力から読み込んだ診断対象の患者の数値データに対して，`knn_diag` 関数による心臓病診断を行い，心臓病ならば `You have a heart disease!`，そうでなければ `You are healthy!` と表示せよ（文の末尾に改行を挿入せよ）．k近傍法における $k$ の値は `3` とせよ．

一見複雑に見えるが，これまでに学んだ「配列の動的確保」「ソート」の知識を応用することで人工知能を実現できる．問題を小さく分解し，着実に一つずつ解いてみよう．必要に応じて，ページ下部のヒントも参考にしてほしい．


## 実行例

```
$ ./a.out
```


## 出力例

`#`は標準入力，`>`は標準出力を表す．

```
# 4
# 1
# 3.0 1
# 1.0 0
# 5.0 1
# 4.0 0
# 0.0
> 1.000000 0
> 3.000000 1
> 4.000000 0
> You are healthy!

# 5
# 2
# 180.0 60.0 0
# 164.0 90.0 1
# 151.0 80.0 1
# 153.0 50.0 0
# 172.0 40.0 0
# 150.0 60.0
> 10.440307 0
> 20.024984 1
> 29.732137 0
> You are healthy!
```

※自動採点システムのテストケースは，米医療機関 Cleveland Clinic Foundation 提供の[心臓病の診断結果のデータセット](http://archive.ics.uci.edu/ml/datasets/Heart+Disease)をもとに作成した．


## ヒント

- (1): $N \times A$ の配列の作り方: これまでに学んできた `int` 型の配列と同様の考え方をしてみよう．`int` 型の配列では，配列の各要素 (`A[0]` など) は `int` 型の変数であった．では，配列型 (例えば `int*`) の配列を作れば...？ 各要素は配列を表す変数となり，これに対してさらに配列を動的に確保することも可能になる．こうすれば，`A[0][0]` のような二次元配列が実現できる．`int` の二次元配列の変数は，`int**` 型で宣言する．
- (2): 2点間 $X=(x_0, x_1, x_2, ..., x_n), Y=(y_0, y_1, y_2, ..., y_n)$ のユークリッド距離 $d(X, Y)$ は $\sqrt{(x_1 - y_1)^2 + (x_2 - y_2)^2 + ... + (x_n - y_n)^2}$ で与えられる．
    - 平方根の計算: `math.h` を `#include` した上で `sqrt` 関数を用いよ．
- (3): まずは $X$ を選択ソートによりソートするプログラムを書く．その後，走査中の変数の値 `X[i]` と最小の変数の値 `X[j]` を入れ替える部分で，`Y[i]` と `Y[j]` の値も入れ替えるようにする．
- (4): 次のような考え方でプログラムを作ってみよう．
    - 過去の診断結果の患者データとの距離と診断結果を格納する，$N$ 次元の `double` 型の配列 $S$，クラスを格納する $N$ 次元の `int` 型の配列 $C$ を作成せよ．
    - 過去の診断結果のそれぞれについて，`eu_dist` 関数を用いて患者の数値データと $P$ の近さを計算し，距離を $S$ に，$C$ にその診断結果を保存せよ．
    - 入力事例に近い $k$ 個の事例を求めるために，まず $S$ の値に基づいて $S$ と $C$ を昇順にソートする (`sort_by(S, C, N)` を用いよ) ．この後，$C$ の先頭 $k$ 個を見れば，入力事例に近い $k$ 個の過去の分類結果，ということになる．つまり，`vote(C, k)` の返り値から，k近傍法による診断結果を得ることができる．
