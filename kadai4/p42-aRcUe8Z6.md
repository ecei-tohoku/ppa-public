---
layout: page
title: 4-2. 単純移動平均【初歩】
---

[単純移動平均 (SMA: Simple Moving Average)](https://ja.wikipedia.org/wiki/%E7%A7%BB%E5%8B%95%E5%B9%B3%E5%9D%87)を用いた金融データ（為替レート）の分析を体験しよう．

単純移動平均は，時系列データの傾向を調べる際しばしば用いられる指標であり，
形式的には，$N$日分の観測値からなる時系列データ$x_1, x_2, ..., x_N$に対して，日付$t$における，$M$日の単純移動平均は次式で定義される．
簡単に言えば，時系列データの各時点$t$における「当日から$M-1$日前までの平均」のことである：

$$ {\rm SMA}^{(M)}_t = \frac{x_t + x_{t-1} + ... + x_{t-M+1}}{M} $$

投資では，短期移動平均線（例えば${\rm SMA}^{(5)}$）が長期移動平均線（例えば${\rm SMA}^{(20)}$）を下から上に突き抜けた時をゴールデンクロスと呼び，買い（上昇トレンド）のシグナルとして用いられる．逆に，短期移動平均線が長期移動平均線を上から下に突き抜けた時をデッドクロスと呼び，売り（下降トレンド）のシグナルとして用いられる．下の図はある時系列データに対して5日単純移動平均，20日単純移動平均を取ってプロットした結果である．

。。。図。。。

より一般的には，連続するデータの上がり下がりが激しい場合に，その点の周りで平均を取ることで”データの傾向”を統計的に調べることができ，物理実験の測定データなどの解析にもよく用いられる手法である．

ここでは，$M$日単純移動平均を求めるプログラムを作成しよう．

---
## 問題
---

標準入力からデータ数$N$，単純移動平均を計算する日数$M$，$N$個の観測値からなる時系列データ$x_1, x_2, ..., x_{N}$を読み込み，標準出力に日付$t$，観測値$x_t$, $M$日単純移動平均${\rm SMA}^{(M)}_t$を出力するプログラムを書け．

---
## 仕様
---

- 入力は，データ数$N$と平均を取る日数$M$，$N$個の時系列データ$x_1, x_2, ..., x_{N}$が順に並んでいるとする：

  ```
  N M
  x_{1}
  x_{2}
  ...
  x_{N}
  ```

- $N$，$M$を格納する変数には`int`型，$x_{i}$を格納する変数には<font color=red>倍精度浮動小数点</font>型である`double`型を用いること．単精度浮動小数点型floatを用いてはいけない．
- $M$は$1<=M<=20$，$N$は$M<=N<=100$であると仮定してよい．
- 出力は，$t$，$x_t$，${\rm SMA}^{(M)}_{t}$ ($t=M, M+1, ..., N$)を一行ずつ出力すること：
  
  ```
  M x_{M} SMA^{(M)}_{M}
  M+1 x_{M+1} SMA^{(M)}_{M+1}
  ...
  N x_{N} SMA^{(M)}_{N}
  ```

- $t$ ($t=M, M+1, ..., N$)は整数で出力し，$x_t$，${\rm SMA}^{(M)}_{t}$ ($t=M, M+1, ..., N$)は小数点以下2位までを出力すること．
- 各行の数値の間には空白文字を入れること．
- 各行の末尾には改行文字`\n`を付けること．
- 必要に応じて，`main`関数内で`double`型配列の動的メモリ確保を`malloc`関数を用いて行うこと．確保した配列は`main`関数が終了する前に`free`関数を用いて解放すること．

---
## 浮動小数点
---

- intは整数だけしか扱えない．小数点を扱うための型としてdouble 64 bit, float 32 bit
- scanfの書式はfloatとdoubleで異なる：scanf("%f", &x_float); scanf("%lf", &x_double);
- printfの書式はfloatとdoubleで共通：printf("%f\n", x_float); printf("%f\n", x_double);
- 小数点以下の桁数を指定して出力できる：printf("%.2f\n", x_double);では，小数点以下２桁のみ表示．
- int型では扱える整数の大きさに制限があるが，浮動小数点型では大きさの他，小数点以下の桁数に制限がある（ここでは深くは立ち入らない）．
- 基本的な演算はint型と同じようにできる．

---
## 実行例
---

- 入力例1

```
10 2
1
-1
1
-1
1
-1
1
-1
1
-1
```
- 出力例1
  
```
2 0.00
3 0.00
4 0.00
5 0.00
6 0.00
7 0.00
8 0.00
9 0.00
10 0.00
```
- 入力例2

```
40 20
83.78
82.92
82.61
83.62
83.98
83.82
83.95
83.56
83.87
84.25
84.06
84.09
83.74
122.15
110.54
100.84
122.04
120.39
83.83
83.19
82.97
82.72
82.33
81.44
81.84
92.04
93.39
93.36
92.91
93.32
93.12
82.81
82.93
82.77
82.64
82.17
83.05
82.72
82.63
82.24
```
- 出力例2
  
```
20 83.19 91.56
21 82.97 91.52
22 82.72 91.51
23 82.33 91.50
24 81.44 91.39
25 81.84 91.28
26 92.04 91.69
27 93.39 92.16
28 93.36 92.65
29 92.91 93.11
30 93.32 93.56
31 93.12 94.01
32 82.81 93.95
33 82.93 93.91
34 82.77 91.94
35 82.64 90.54
36 82.17 89.61
37 83.05 87.66
38 82.72 85.78
39 82.63 85.72
40 82.24 85.67
```

---
## 余談
---
移動平均の応用は，信号処理全般にわたって広がっている．画像処理では，画像のノイズを除去して滑らかにするために移動平均が用いられる．音声処理では，移動平均は有限インパルス応答（FIR）フィルタの特殊形であり，ローパスフィルタ（LPF）として用いることができる．
