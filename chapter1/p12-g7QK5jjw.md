---
layout: page
title: 1-2. コラッツの問題【初歩】
---

好きな正整数に対して，「偶数なら2で割り，奇数なら3倍して1加える」という操作を繰り返すと最後には$1$に到達することが経験的に知られている．たとえば$3$からはじめてこの操作を繰り返すと$3\to 10\to 5\to 16\to 8\to 4\to 2\to 1$というステップを経て$1$に到達する．
今のところ反例（$1$に到達しない正整数）は見つかっていないが，任意の正整数に対して上の主張が成り立つかどうかについては未解決問題である．[コラッツの問題](https://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%A9%E3%83%83%E3%83%84%E3%81%AE%E5%95%8F%E9%A1%8C)，角谷の問題，3n+1問題などと呼ばれる．
ここでは実際に正整数を受け取って$1$に到達するまで上の操作を自動的に繰り返すプログラムを作成しよう．

---
## 問題
---
標準入力から正整数$x_1$を読み込み，以下の漸化式にしたがって$x_2, x_3, ...$を順に求めて標準出力に書き出し，$x_i = 1$となったら反復を終了するプログラムを作成せよ．

$$
x_{i+1} = \begin{cases}
    x_{i} / 2 & \text{（$x_i$が偶数のとき）} \\
    3x_{i} + 1 & \text{（$x_i$が奇数のとき）}
    \end{cases}
$$

ただし，プログラムは以下の仕様を満たすこと．

1. 入力される整数$x_1$が$2 \leq x_1 \leq 100000$を満たさない時は，`Error`と表示して終了する．
1. $x_i$（$i = 1, 2, ...$）の値を1行ずつ表示せよ．入力された値（$x_1$）を表示し忘れないように留意せよ．
1. $x_i = 1$になった時は，その計算結果`1`を表示したのち，`OK`と表示してプログラムを終了せよ．
1. $x_{100}$まで計算しても値が$1$にならない場合は，$x_{100}$の値を表示したのち，そのままプログラムを終了せよ．このときは`OK`と表示しないこと．
1. 各表示は標準出力に出力し，それぞれ末尾には改行文字`\n`を付けること．

---
## 実行例
---
`#`は標準入力，`>`は標準出力を表す．

```
# 3
> 3
> 10
> 5
> 16
> 8
> 4
> 2
> 1
> OK
```

```
# 10
> 10
> 5
> 16
> 8
> 4
> 2
> 1
> OK
```

```
# 27
> 27
> 82
> 41
> 124
... (途中省略) ...
> 70
> 35
> 106
```

---
### 手順例
---

問題を分解して考える．

1. 標準入力から正整数$x_1$を読み込む
1. $x_{i+1}$ を繰り返し計算
1. $x_{i+1}$ を出力


---
#### 0. 準備

これまでと同様に，まず，確実に必要と思われるC言語のメインの構造を作ってみる．

```
#include <stdio.h>

int main()
{
  return 0;
}
```

---
#### 1. 標準入力から正整数$x_1$を読み込む

次に，読み込み部分を考える．

- p1-1と同じ要領で，読み込む関数`scanf`を使って値を読み込む部分を作る．

```
#include <stdio.h>

int main()
{
  scanf("%d", &xxx);
  return 0;
}
```

---
#### 2. 繰り返し計算

次に，計算する部分を考える．

- まずは，偶数か奇数かによって条件が変わるので，条件部分を作成（偶数か奇数かを判定する条件式は，以下の"#####"の部分を各自で補完して欲しい．）

```
#include <stdio.h>

int main()
{
  scanf("%d", &xxx);
  if(xxx ### ){  // 偶数の場合

  }
  else{

  }
  return 0;
}
```

- 次に，各条件に従って計算部分を作成

```
#include <stdio.h>

int main()
{
  scanf("%d", &xxx);
  if(xxx ### ){  // 偶数の場合
    xxx /= 2
  }
  else{
    xxx *= 3 + 1
  }
  return 0;
}
```

- 最後に，繰り返し計算部分を作る．

```
#include <stdio.h>

int main()
{
  scanf("%d", &xxx);
  for(;;){
    if(xxx ### ){  // 偶数の場合
      xxx /= 2
    }
    else{
      xxx *= 3 + 1
    }
  }
  return 0;
}
```

---
#### 3. $x_{i+1}$ を出力

- 値の出力部分を構築

```
#include <stdio.h>

int main()
{
  scanf("%d", &xxx);
  for(;;){
    if(xxx ### ){  // 偶数の場合
      xxx /= 2
    }
    else{
      xxx *= 3 + 1
    }
    printf("%d", xxx);
  }
  return 0;
}
```

- ただし，上記のプログラムはそのままではコンパイルエラーになる．それぞれコンパイルエラーになるところを修正すること

---
#### 条件

- 次に，各条件を考える．

---
#### 4. 入力される整数$x_1$が$2 \leq x_1 \leq 100000$を満たさない時は，`Error`と表示して終了する．

- 入力された整数のエラー処理部分を構築する．課題1-1のときの要領で入力したのちに条件を満たしているかどうかをかけばよい

---
#### 5. 入力された値（$x_1$）を表示し忘れないように留意せよ．

- 現状のプログラムは$x_1$が表示されない．$x_1$を表示するためにプログラムを修正すること

---
#### 7. $x_i = 1$になった時は，その計算結果`1`を表示したのち，`OK`と表示してプログラムを終了せよ．

- 繰り返し計算のどこかに以下の様な終了条件をいれればよい

```
    if (x == 1) { // 終了条件
      printf("%d", xxx);
      printf("OK");
      break;
    }
```

- ただし上記の部分もエラーを含むので，各自修正すること

---
#### 8. $x_{100}$まで計算しても値が$1$にならない場合は，$x_{100}$の値を表示したのち，そのままプログラムを終了せよ．このときは`OK`と表示しないこと．

- `for`文の条件を入れる．繰り返し計算は100回まで

---
#### 9. 各表示は標準出力に出力し，それぞれ末尾には改行文字`\n`を付けること．

- p1-1の要領で出力時に必ず改行文字`\n`を入れる様に修正すること


---
#### 手順例まとめ

繰り返しになるが，この課題の上記参考プログラムは，あえていくつか間違いを含んだ状態で記載している．わからない場合は，コンパイルや実行をして，実際のエラーメッセージや出力結果を参考にプログラムの間違いを修正すること．

---
## 参考情報
---
---
### `for`文や`while`文による繰り返し処理，`continue`文，`break`文
---
- 繰り返し処理には`for`文や`while`文が用いられる．
- また，「次の繰り返しに移動」「繰り返し自体をやめる」の命令のために`continue`文と`break`文が用意されている．
- （余談）`for`，`while`，`continue`，`break`も，他の多くの言語で似ている構文が用意されている．
- 林：9.3 `while`文，9.4 `for`文，9.5`do`-`while`文，9.7 `break`文，9.8 `continue`文
- 倉：3-3 繰り返し処理1--`for`文，3-4 繰り返し処理2--`while`文
- 高橋：Lesson 6 何度も繰り返す

---
#### `for`文について

繰り返し処理では`for`文や`while`文が用いられる．
大雑把にいうと、繰り返し処理の回数がわかっている場合は`for`文、繰り返し処理の回数が決まっておらずある条件を満たす限り処理を繰り返したい場合は`while`文が用いられることが多い。
(`for`文で書かれたコードを`while`文で書くこと、`while`文で書かれたコードを`for`文で書くことも可能である。あくまで目安として。)

`for`文の基本的な書き方は次の通りである。

```
    for (初期化の式1; 繰り返すかどうか調べる式2; 変化のための式3) {
      文;
    }
```

`for`文では、まず初期化の式1にしたがって初期化を行う。次に、繰り返すかどうか調べる式2が真であれば`for`文の中の文の処理を行い、式3の処理を行う。式2の条件が偽になるまでこの操作を繰り返す。
これでは分かりづらいので、例として、`for`文を用いて繰り返し足し算を行うコードを考えてみよう。

```
    int i; //for文で用いるループ変数iを定義
    int x = 0; //for文の中で用いる変数xを定義
    
    for (i=0; i<4; i=i+1) {
      x = x + 1;
    }
```

ループ変数iは繰り返し回数をカウントする変数である。このコードではi<4である限り、for文の中の処理を繰り返し行う。
上のコードではi=0から出発してiを一つずつ増やし、iの値が4より小さければ（つまり、i=3まで）xに1を足していき、iの値が4になれば修了するプログラムである。
したがって、初期値x=0に1を4回（i=0,1,2,3）足していくので、最終的にxの値は4となる。

コードを書くのに慣れてくれば、足し算i=i+1をi++と簡略化して次のように書くことも可能である。


```
    int i; //for文で用いるループ変数iを定義
    int x = 0; //for文の中で用いる変数xを定義
    
    for (i=0; i<4; i++) {
      x++;
    }
```

このコードを少し修正して、for文で使われたループ変数iの値をxに足していくことも可能である。

```
    int i; //for文で用いるループ変数iを定義
    int x = 0; //for文の中で用いる変数xを定義
    
    for (i=0; i<4; i++) {
      x = x + i;
    }
```

この場合、i=0,i=1,i=2,i=3の値をxに足していくので、最終的にxの値は6となる。



---
#### `while`文について

`while`文の基本的な書き方は次の通りである。

```
    while (条件) {
      文;
    }
```

`while`文では条件が真である限り、`while`文の中の処理を繰り返し行う。`while`文を用いて先ほどの足し算を書いてみよう。

```
    int i=0; //while文の条件で用いる変数iを定義
    int x = 0; //while文の中で用いる変数xを定義
    
    while (i<4) {
      x++;
      i++;
    }
```

この場合、i<4である限り、`while`文の中の処理は繰り返される。
i=0なので、xに1を足しx=1、次にiに1を足しi=1
i=1なので、xに1を足しx=2、次にiに1を足しi=2
i=2なので、xに1を足しx=2、次にiに1を足しi=2
i=3なので、xに1を足しx=2、次にiに1を足しi=2
i=4なのでwhile文の条件を満たさないので修了


---
## 余談
---
コラッツの問題は[コンピュータを用いたシミュレーション](http://sweet.ua.pt/tos/3x_plus_1.html)により，$20 \times 2^{58}$（$\approx 5.76 \times 10^{18}$）までの値に対しては最終的に$1$に到達することが確認されている．

プログラムを確実に停止させるため，反復は100回までという制限を設けた．この制限を緩和もしくは撤廃すれば，（このプログラムが対応できる範囲の）どんな自然数を入力しても，有限回の操作で1に到達することを自分の目で確認できるであろう．

---
## 参考文献
---
+ 浦田敏夫. [コラッツの問題](http://www.auemath.aichi-edu.ac.jp/publish/booklet/01/collatz_problem.pdf). 愛知教育大学ブックレット 数学／数理科学セレクトⅠ, 2002年.
