---
layout: page
title: 2-5. マージソート【10点】
---

## 問題
データファイルをリダイレクト `<` を使って標準入力させて，入力された配列データをマージソートによって<font color="red">昇順</font>に並べ替えるプログラムを作成せよ．ただし，以下の仕様を満たすこと．

- データファイルの内容は，以下の通りである．
  - データファイルの 1 行目に，ソートすべきデータの個数 $n$ が記載されている．なお，$n$ の値は 2 のべき乗となっている．
  - データファイルの 2 行目に，ソートすべき $n$ 個のデータが半角スペースで区切られて記載されている．なお，すべてのデータの値は，`int` 型で収まる範囲内にある正の整数となっている．
- `main` 関数内で，データファイルを読み込む．
  - ソートすべき $n$ 個のデータを読み込む際には，データの格納に必要なメモリ領域を動的に確保すること．また，確保したメモリ領域については，所望の処理が完了した後に解放すること．
- 入力された $n$ 個の配列データに対し，マージソートのアルゴリズムを適用する `mergesort` 関数を作成する．
  - 配列データをソートする際，比較回数（配列データに対して実行される比較命令の回数）を数えること．ただし，計測結果を `mergesort` 関数内で表示してはいけない．
  - ソート後の配列データを `mergesort` 関数内で表示してはいけない．
  - グローバル変数および静的変数を使用してはいけない．
  - `mergesort` 関数の作成においては，【マージソートのアルゴリズム】を参考のこと．
  - 再帰呼び出しを用いること．
  - マージソートの実行にあたり，必要があれば配列データのメモリ領域を動的に確保すること．確保されたメモリ領域については，所望の処理が完了した後に適宜解放すること．
- ソート後の配列データと比較回数の計測結果とを `main` 関数内で標準出力し，プログラムを終了する．
  - まず，ソート後の配列データを標準出力し，その後，比較回数の計測結果を標準出力すること．
  - ソート後の配列データを表示する際には，配列の各要素を半角スペースで区切って表示すること．

## 実行例
入力されるデータファイル ([sortdata.txt](./sortdata.txt)) の例

```
8
2 4 3 1 8 7 6 5
```

プロンプト上で `sortdata.txt` をリダイレクト `<` を使って標準入力させる．

```
$ ./a.out < sortdata.txt
```

`sortdata.txt` に対する実行結果の例（`>` は標準出力を示し，`⊔` は半角スペースを示す．）

```
> 1⊔2⊔3⊔4⊔5⊔6⊔7⊔8
> 13
```

## マージソートのアルゴリズム
以下のプログラムでは，`mergesort` 関数において，2 つの配列をマージするための関数 `merge` を呼び出していることに注意されたい．つまり，`mergesort` 関数だけでなく `merge` 関数も作成する必要がある．なお[問題2-2](p22.html "問題2-2") と同様に，各自でプログラムを作成する際には，下記の 2 つの関数の形式（引数と戻り値の与え方）を自由に変更してよい．

再帰呼び出しを用いたマージソート関数の例

```c
/* s[p]～s[q] をソートする */
void mergesort(int *s, int *a, int *b, int *c, int p, int q) {
  int i, med;
  if (p < q) {
    med = (p + q)/2;
    mergesort(p, med); /* s の前半をソートする */
    mergesort(med + 1, q); /* s の後半をソートする */
    /* s の前半（ソート済み）を a にコピー */
    for (i = p; i <= med; i++) {
      a[i - p] = s[i];
    }
    /* s の後半（ソート済み）を b にコピー */
    for (i = med + 1; i <= q; i++) {
      b[i - med - 1] = s[i];
    }
    /* a と b をマージして結果 c を s に戻す */
    merge(med - p + 1, q - med);
    for (i = p; i <= q; i++) {
      s[i] = c[i - p];
    }
  }
}
```

2 つの配列をマージする関数の例

```c
/* a[0]～a[end_a - 1] と b[0]～b[end_b - 1] をマージし，c[0]～c[end_a + end_b - 1] にする */
void merge(int *a, int *b, int *c, int end_a, int end_b) {
  int i = 0, j = 0, k = 0;
  while ((i < end_a) && (j < end_b)) {
  /* a と b の小さい方から c に代入 */
    if (a[i] < b[j]){
      c[k] = a[i];
      k++;
      i++;
    }
    else {
      c[k] = b[j];
      k++;
      j++;
    }
  }
  /* 残ったデータを c にコピー */
  if (i >= end_a) {
    while (j < end_b) {
      c[k] = b[j];
      k++;
      j++;
    }
  }
  else {
    while (i < end_a) {
      c[k] = a[i];
      k++;
      i++;
    }
  }
}
```
